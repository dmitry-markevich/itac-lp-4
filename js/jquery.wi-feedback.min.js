!function(i){i(document).ready(function(){i.fn.wiFeedBack=function(e){function d(){var e=0;return n.find("input, select, textarea").each(function(){i(this).get(0).checkValidity()||e++}),0==e?!0:!1}function l(){n.find("input, select, textarea").each(function(){i(this).val("")})}var s,n=this,t=Math.floor(899999*Math.random()+1e5),a=i.extend({fbScript:"/wi-feedback.php",fbLink:".wi-fb-link",fbDelegate:!1,fbBeforeOpen:null,fbBeforeClose:null,fbColor:"#00aff0"},e);if(i("head").append('<style wi-fb-id="'+t+'">.wi-fb-'+t+" .wi-fb-msg-sending,.wi-fb-"+t+" .wi-fb-msg-sent,.wi-fb-"+t+" .wi-fb-title h2{color:"+a.fbColor+"}.wi-fb-"+t+" .wi-fb-btn button{background:"+a.fbColor+"}</style>"),n.addClass("wi-fb wi-fb-"+t).attr("wi-fb-id",t),n.find("h2").wrap('<div class="wi-fb-title"></div>'),n.find("h3").wrap('<div class="wi-fb-text"></div>'),n.find("input, select, textarea").wrap('<div class="wi-fb-line"></div>'),n.find("input, select, textarea").each(function(){var e=i(this).attr("data-wi-fb-label");""!=e&&"undefined"!=typeof e&&(i(this).parent().prepend("<label>"+e+"</label>"),i(this).prop("required")&&i(this).parent().find("label").append("<span> *</span>"))}),n.find("button").wrap('<div class="wi-fb-btn"></div>'),"ru-ru"==i("html").attr("lang")?n.append('<div class="wi-fb-spinner"></div><div class="wi-fb-msg-invalid">Отмеченные поля заполнены некорректно</div><div class="wi-fb-msg-sending">Идет отправка данных...</div><div class="wi-fb-msg-sent">Ваша заявка принята!</div><div class="wi-fb-msg-notsent">При отправке данных произошла ошибка</div>'):n.append('<div class="wi-fb-spinner"></div><div class="wi-fb-msg-invalid">Marked fields are required</div><div class="wi-fb-msg-sending">Sending data...</div><div class="wi-fb-msg-sent">Your request is sent!</div><div class="wi-fb-msg-notsent">An error occurred while sending data</div>'),n.find(".wi-fb-btn button").on("click",function(){if(n.removeClass("invalid sent notsent"),d()){var e={},t=[];n.find("input, select, textarea").each(function(){t.push({name:i(this).attr("data-wi-fb-caption")||i(this).attr("wi-fb-caption")||i(this).attr("name"),value:i(this).val()})}),s&&t.push({name:"Дополнительная информация",value:s}),e.action="feedback",e.fields=t,n.addClass("sending"),i.ajax({url:a.fbScript,type:"POST",data:e,cache:!1,success:function(i){"1"==i?(n.removeClass("sending"),n.addClass("sent"),l()):(n.removeClass("sending"),n.addClass("notsent"))},error:function(){n.removeClass("sending"),n.addClass("notsent")}})}else n.addClass("invalid")}),0!=a.fbLink){n.addClass("wi-fb-modal");var f={};a.fbDelegate&&(f.delegate=a.fbLink),f.type="inline",f.callbacks={},f.fixedContentPos=!0,"function"==typeof a.fbBeforeOpen&&(f.callbacks.open=a.fbBeforeOpen),"function"==typeof a.fbBeforeClose&&(f.callbacks.close=a.fbBeforeClose),a.fbDelegate?i("body").magnificPopup(f):i(a.fbLink).magnificPopup(f),i("body").on("click",a.fbLink,function(){n.removeClass("sent notsent"),s=i(this).attr("data-wi-fb-info")||i(this).attr("wi-fb-info")||""})}return t}})}(jQuery);